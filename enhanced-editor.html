<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juri Enhanced Dialog-Editor</title>
    <link rel="stylesheet" href="assets/css/variables.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--admin-bg); color: var(--admin-text); overflow: hidden; }
        .container { display: flex; height: 100vh; }
        .sidebar { width: 300px; background: var(--admin-surface); border-right: 1px solid var(--admin-border); display: flex; flex-direction: column; }
        .sidebar-header { padding: var(--spacing-md); border-bottom: 1px solid var(--admin-border); display: flex; align-items: center; gap: var(--spacing-sm); }
        .sidebar-header h2 { color: var(--admin-text); font-size: 16px; }
        .logo-container { width: 80px; height: 34px; }
        .editor-area { flex: 1; display: flex; flex-direction: column; }
        .editor-header { background: var(--admin-surface); padding: var(--spacing-md); border-bottom: 1px solid var(--admin-border); display: flex; justify-content: space-between; align-items: center; }
        .editor-content { flex: 1; display: flex; }
        .form-editor { flex: 1; background: var(--admin-bg); padding: var(--spacing-lg); overflow-y: auto; }
        .form-section { background: var(--admin-surface); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg); border: 1px solid var(--admin-border); }
        .form-section h3 { color: var(--primary-color); margin-bottom: var(--spacing-md); font-size: 18px; display: flex; align-items: center; gap: var(--spacing-sm); }
        .form-group { margin-bottom: var(--spacing-md); }
        .form-label { display: block; font-size: 12px; color: var(--admin-text-muted); margin-bottom: var(--spacing-xs); font-weight: 600; text-transform: uppercase; }
        .form-input, .form-select, .form-textarea { width: 100%; background: var(--admin-bg); border: 1px solid var(--admin-border); color: var(--admin-text); padding: var(--spacing-sm); border-radius: var(--radius-sm); font-size: 14px; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--primary-color); }
        .form-textarea { min-height: 100px; font-family: 'Consolas', monospace; }
        .dynamic-list { border: 1px solid var(--admin-border); border-radius: var(--radius-sm); }
        .list-item { display: flex; align-items: center; padding: var(--spacing-sm); border-bottom: 1px solid var(--admin-border); }
        .list-item:last-child { border-bottom: none; }
        .list-item input { flex: 1; background: transparent; border: none; color: var(--admin-text); padding: var(--spacing-xs); }
        .list-item input:focus { outline: none; background: var(--admin-bg); }
        .btn-small { background: var(--admin-surface-light); color: var(--admin-text); border: 1px solid var(--admin-border); padding: 4px 8px; border-radius: var(--radius-sm); cursor: pointer; font-size: 12px; }
        .btn-small:hover { background: var(--admin-border); }
        .btn-small.danger { background: #ff4757; color: white; border-color: #ff4757; }
        .btn-small.success { background: var(--secondary-color); color: white; border-color: var(--secondary-color); }
        .add-btn { width: 100%; background: var(--primary-color); color: white; border: none; padding: var(--spacing-sm); border-radius: var(--radius-sm); cursor: pointer; margin-top: var(--spacing-sm); }
        .add-btn:hover { background: var(--primary-light); }
        .question-types { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-sm); margin-bottom: var(--spacing-md); }
        .question-type { background: var(--admin-bg); border: 2px solid var(--admin-border); border-radius: var(--radius-sm); padding: var(--spacing-sm); cursor: pointer; text-align: center; transition: var(--transition-fast); }
        .question-type:hover { border-color: var(--primary-color); }
        .question-type.active { border-color: var(--primary-color); background: rgba(91, 75, 160, 0.1); }
        .question-type-icon { font-size: 20px; margin-bottom: var(--spacing-xs); }
        .question-type-name { font-size: 12px; font-weight: 600; }
        .tree-container { flex: 1; overflow-y: auto; padding: var(--spacing-sm); }
        .tree-item { padding: 6px 8px; cursor: pointer; display: flex; align-items: center; gap: var(--spacing-sm); border-radius: var(--radius-sm); transition: var(--transition-fast); }
        .tree-item:hover { background: var(--admin-surface-light); }
        .tree-item.selected { background: var(--primary-color); color: white; }
        .tree-item.file { margin-left: 16px; opacity: 0.9; }
        .tree-icon { width: 16px; text-align: center; }
        .properties-panel { width: 280px; background: var(--admin-surface); border-left: 1px solid var(--admin-border); padding: var(--spacing-md); overflow-y: auto; }
        .properties-panel h3 { margin-bottom: var(--spacing-md); }
        .toolbar { padding: var(--spacing-sm); border-bottom: 1px solid var(--admin-border); display: flex; gap: var(--spacing-xs); flex-wrap: wrap; }
        .section-header { padding: var(--spacing-sm); background: var(--admin-surface-light); font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--admin-text-muted); }
        .btn { background: var(--primary-color); color: white; border: none; padding: 8px 16px; border-radius: var(--radius-sm); cursor: pointer; font-size: 14px; }
        .btn:hover { background: var(--primary-light); }
        .btn-secondary { background: var(--admin-surface-light); color: var(--admin-text); }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .status-bar { background: var(--primary-color); color: white; padding: 6px var(--spacing-md); font-size: 12px; display: flex; justify-content: space-between; }
        .preview-container { background: var(--admin-surface); border-radius: var(--radius-sm); padding: var(--spacing-md); margin-top: var(--spacing-md); }
        .preview-container h4 { margin-bottom: var(--spacing-sm); color: var(--primary-color); }
        .file-input { display: none; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="assets/js/components/rechtCleverLogo.js"></script>
    <script src="assets/js/utils/dialogStorage.js"></script>
    <script src="assets/js/utils/zipProcessor.js"></script>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo-container" id="logoContainer"></div>
                <h2>Enhanced Editor</h2>
            </div>
            <div class="toolbar">
                <button class="btn btn-sm" onclick="editor.newQuestion()">‚ûï Frage</button>
                <button class="btn btn-sm" onclick="editor.newFolder()">üìÅ Ordner</button>
                <button class="btn-secondary btn-sm" onclick="editor.importZip()">üìÇ Import</button>
            </div>
            <div class="section-header">DIALOG STRUKTUR</div>
            <div class="tree-container" id="treeContainer"></div>
        </div>
        <div class="editor-area">
            <div class="editor-header">
                <h2>Dialog-Frage bearbeiten</h2>
                <div>
                    <button class="btn" onclick="editor.save()">üíæ Speichern</button>
                    <button class="btn" onclick="editor.exportZip()">üì¶ Export</button>
                    <button class="btn" onclick="editor.deployToChatbot()">üöÄ Deploy</button>
                </div>
            </div>
            <div class="editor-content">
                <div class="form-editor" id="formEditor">
                    <div class="form-section">
                        <h3>üìù Grund-Information</h3>
                        <div class="form-group">
                            <label class="form-label">Titel (Fragetext)</label>
                            <input type="text" class="form-input" id="questionTitle" placeholder="# Wie ist dein Zivilstand?">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Untertitel (optional)</label>
                            <input type="text" class="form-input" id="questionSubtitle" placeholder="Zus√§tzliche Erkl√§rung">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Bezeichner (Variable)</label>
                            <input type="text" class="form-input" id="questionDesignator" placeholder="$Zivilstand123$">
                        </div>
                    </div>
                    <div class="form-section">
                        <h3>‚ùì Fragetyp</h3>
                        <div class="question-types">
                            <div class="question-type" data-type="Single Select"><div class="question-type-icon">‚òù</div><div class="question-type-name">Single Select</div></div>
                            <div class="question-type" data-type="Multiple Choice"><div class="question-type-icon">‚òë</div><div class="question-type-name">Multiple Choice</div></div>
                            <div class="question-type" data-type="Text"><div class="question-type-icon">üìù</div><div class="question-type-name">Text</div></div>
                            <div class="question-type" data-type="Number"><div class="question-type-icon">üî¢</div><div class="question-type-name">Number</div></div>
                            <div class="question-type" data-type="Currency"><div class="question-type-icon">üí∞</div><div class="question-type-name">Currency</div></div>
                            <div class="question-type" data-type="Date"><div class="question-type-icon">üìÖ</div><div class="question-type-name">Date</div></div>
                            <div class="question-type" data-type="Person"><div class="question-type-icon">üë§</div><div class="question-type-name">Person</div></div>
                            <div class="question-type" data-type="Address"><div class="question-type-icon">üè†</div><div class="question-type-name">Address</div></div>
                        </div>
                        <input type="hidden" id="questionType" value="Single Select">
                    </div>
                    <div class="form-section" id="answersSection">
                        <h3>üí¨ Antworten</h3>
                        <div class="dynamic-list" id="answersList"></div>
                        <button class="add-btn" onclick="editor.addAnswer()">+ Antwort hinzuf√ºgen</button>
                    </div>
                    <div class="form-section">
                        <h3>üîß Script (optional)</h3>
                        <div class="form-group">
                            <label class="form-label">JavaScript/C#-√§hnliche Logik</label>
                            <textarea class="form-textarea" id="questionScript" rows="10" placeholder="if (#flag == 'true') {\n    #name = 'Max';\n} else {\n    goto $andere-frage$;\n}"></textarea>
                        </div>
                        <div class="preview-container">
                            <h4>Script-Hilfe</h4>
                            <ul style="margin-left: 20px; margin-top: 8px;">
                                <li><code>if (#variable == "wert")</code></li>
                                <li><code>#variable = "wert"</code></li>
                                <li><code>goto $ziel$</code></li>
                                <li><code>||</code>, <code>&&</code></li>
                            </ul>
                        </div>
                    </div>
                    <div class="form-section">
                        <h3>üìÑ Dokumentenerstellung (optional)</h3>
                        <div class="form-group">
                            <label class="form-label">Dokumenttext</label>
                            <textarea class="form-textarea" id="documentText" rows="4" placeholder="Text f√ºr das generierte Dokument..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="properties-panel">
                    <h3>Eigenschaften</h3>
                    <div class="form-group">
                        <label class="form-label">Dateiname</label>
                        <input type="text" class="form-input" id="fileName" placeholder="zivilstand.txt">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pfad</label>
                        <input type="text" class="form-input" id="filePath" readonly>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-sm" onclick="editor.updateFile()">üíæ √úbernehmen</button>
                        <button class="btn-secondary btn-sm" onclick="editor.deleteFile()">üóë L√∂schen</button>
                    </div>
                    <div class="preview-container">
                        <h4>Live-Vorschau</h4>
                        <div id="livePreview" style="font-size: 12px; background: var(--admin-bg); padding: 8px; border-radius: 4px; margin-top: 8px;"><em>W√§hle eine Frage zum Bearbeiten</em></div>
                    </div>
                    <div class="preview-container">
                        <h4>Generierte TXT-Datei</h4>
                        <pre id="generatedContent" style="font-size: 11px; background: var(--admin-bg); padding: 8px; border-radius: 4px; margin-top: 8px; white-space: pre-wrap; max-height: 200px; overflow-y: auto;"><em>Noch keine Inhalte</em></pre>
                    </div>
                </div>
            </div>
            <div class="status-bar">
                <span id="statusText">Bereit</span>
                <span id="itemCount">0 Fragen</span>
            </div>
        </div>
    </div>
    <input type="file" id="zipFileInput" accept=".zip" class="file-input">
    <script>
        class EnhancedDialogEditor {
            constructor() {
                this.structure = this.loadStructure() || this.createEmptyStructure();
                this.currentFile = null;
                this.selectedItem = null;
                this.init();
            }
            init() {
                if (window.RechtCleverLogo && typeof RechtCleverLogo.render === 'function') {
                    RechtCleverLogo.render('logoContainer', 'small');
                }
                this.attachEventListeners();
                this.renderTree();
                this.updateQuestionTypeHandlers();
                this.setupLivePreview();
            }
            attachEventListeners() {
                const zipInput = document.getElementById('zipFileInput');
                if (zipInput) zipInput.addEventListener('change', (e) => this.handleZipImport(e));
                ['questionTitle','questionSubtitle','questionDesignator','questionScript','documentText'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.addEventListener('input', () => this.updateLivePreview());
                });
            }
            updateQuestionTypeHandlers() {
                document.querySelectorAll('.question-type').forEach(typeEl => {
                    typeEl.addEventListener('click', () => {
                        document.querySelectorAll('.question-type').forEach(el => el.classList.remove('active'));
                        typeEl.classList.add('active');
                        const type = typeEl.dataset.type;
                        document.getElementById('questionType').value = type;
                        const answersSection = document.getElementById('answersSection');
                        if (type === 'Single Select' || type === 'Multiple Choice') {
                            answersSection.style.display = 'block';
                        } else {
                            answersSection.style.display = 'none';
                        }
                        this.updateLivePreview();
                    });
                });
            }
            setupLivePreview() {
                const defaultType = document.querySelector('[data-type="Single Select"]');
                if (defaultType) defaultType.click();
            }
            createEmptyStructure() {
                return { name: 'Root', type: 'folder', children: [], path: '' };
            }
            loadStructure() { return DialogStorage && DialogStorage.load ? DialogStorage.load() : null; }
            renderTree() {
                const container = document.getElementById('treeContainer');
                container.innerHTML = '';
                if (this.structure.children) this.structure.children.forEach(child => this.renderTreeNode(child, container, 0));
                this.updateItemCount();
            }
            renderTreeNode(node, container, depth) {
                const nodeElement = document.createElement('div');
                nodeElement.className = `tree-item ${node.type}`;
                nodeElement.style.paddingLeft = `${depth * 16 + 8}px`;
                const icon = node.type === 'folder' ? 'üìÅ' : '‚ùì';
                nodeElement.innerHTML = `<span class="tree-icon">${icon}</span><span class="tree-label">${node.name}</span>`;
                nodeElement.addEventListener('click', () => this.selectNode(node, nodeElement));
                container.appendChild(nodeElement);
                if (node.type === 'folder' && node.children) node.children.forEach(child => this.renderTreeNode(child, container, depth + 1));
            }
            selectNode(node, element) {
                document.querySelectorAll('.tree-item.selected').forEach(item => item.classList.remove('selected'));
                element.classList.add('selected');
                this.selectedItem = node;
                if (node.type === 'file') this.loadFileIntoForm(node);
            }
            loadFileIntoForm(file) {
                this.currentFile = file;
                if (!file.enhancedContent) file.enhancedContent = this.parseOldFormatToNew(file.content || '');
                const content = file.enhancedContent;
                document.getElementById('questionTitle').value = content.titel || '';
                document.getElementById('questionSubtitle').value = content.untertitel || '';
                document.getElementById('questionDesignator').value = content.bezeichner || '';
                document.getElementById('questionScript').value = content.script || '';
                document.getElementById('documentText').value = content.dokumenttext || '';
                const typeElement = document.querySelector(`[data-type="${content.fragetyp || 'Single Select'}"]`);
                if (typeElement) typeElement.click();
                this.loadAnswers(content.antworten || []);
                document.getElementById('fileName').value = file.name || '';
                document.getElementById('filePath').value = file.path || '';
                this.updateLivePreview();
            }
            loadAnswers(answers) {
                const answersList = document.getElementById('answersList');
                answersList.innerHTML = '';
                answers.forEach(answer => {
                    const listItem = document.createElement('div');
                    listItem.className = 'list-item';
                    listItem.innerHTML = `<input type="text" value="${answer}"><button class="btn-small danger" onclick="this.parentElement.remove(); editor.updateLivePreview()">‚úï</button>`;
                    listItem.querySelector('input').addEventListener('input', () => this.updateLivePreview());
                    answersList.appendChild(listItem);
                });
            }
            parseOldFormatToNew(oldContent) {
                const content = { titel: '', untertitel: '', bezeichner: '', fragetyp: 'Single Select', antworten: [], script: '', dokumenttext: '' };
                const lines = oldContent.split('\n');
                let inScript = false; const scriptLines = [];
                for (const line of lines) {
                    const trimmed = line.trim();
                    if (trimmed.includes('Script Start')) { inScript = true; continue; }
                    if (trimmed.includes('Script End')) { inScript = false; content.script = scriptLines.join('\n'); continue; }
                    if (inScript) { scriptLines.push(line); continue; }
                    if (trimmed.startsWith('#') && !content.titel) {
                        content.titel = trimmed.substring(1).trim();
                    } else if (/^\$[a-zA-Z0-9_]+\$/.test(trimmed)) {
                        content.bezeichner = trimmed;
                    } else if (trimmed.startsWith('(') && trimmed.endsWith(')')) {
                        const option = trimmed.slice(1, -1).trim();
                        content.antworten.push(option);
                    } else if (trimmed.startsWith('/')) {
                        const inputType = trimmed.substring(1);
                        content.fragetyp = this.mapInputTypeToQuestionType(inputType);
                    }
                }
                return content;
            }
            mapInputTypeToQuestionType(inputType) {
                const mapping = { 'text': 'Text', 'number': 'Number', 'currency': 'Currency', 'date': 'Date', 'person': 'Person', 'address': 'Address' };
                return mapping[inputType] || 'Text';
            }
            updateLivePreview() {
                const preview = document.getElementById('livePreview');
                const generatedContent = document.getElementById('generatedContent');
                const formData = this.getFormData();
                let previewHtml = `<strong>${formData.titel}</strong>`;
                if (formData.untertitel) previewHtml += `<br><em>${formData.untertitel}</em>`;
                if (formData.fragetyp === 'Single Select' || formData.fragetyp === 'Multiple Choice') {
                    previewHtml += '<br><br>Optionen:';
                    formData.antworten.forEach(answer => { previewHtml += `<br>‚Ä¢ ${answer}`; });
                }
                preview.innerHTML = previewHtml;
                generatedContent.textContent = this.generateTxtContent(formData);
            }
            getFormData() {
                const answers = Array.from(document.querySelectorAll('#answersList input')).map(i => i.value).filter(v => v.trim());
                return {
                    titel: document.getElementById('questionTitle').value,
                    untertitel: document.getElementById('questionSubtitle').value,
                    bezeichner: document.getElementById('questionDesignator').value,
                    fragetyp: document.getElementById('questionType').value,
                    antworten: answers,
                    script: document.getElementById('questionScript').value,
                    dokumenttext: document.getElementById('documentText').value
                };
            }
            generateTxtContent(formData) {
                let content = '';
                content += `# ${formData.titel}\n`;
                if (formData.untertitel) content += `${formData.untertitel}\n`;
                content += `\n-----\n\n`;
                if (formData.bezeichner) content += `${formData.bezeichner}\n`;
                if (formData.fragetyp === 'Text') content += `/text\n`;
                if (formData.fragetyp === 'Number') content += `/number\n`;
                if (formData.fragetyp === 'Currency') content += `/currency\n`;
                if (formData.fragetyp === 'Date') content += `/date\n`;
                if (formData.fragetyp === 'Person') content += `/person\n`;
                if (formData.fragetyp === 'Address') content += `/address\n`;
                if (formData.fragetyp === 'Single Select' || formData.fragetyp === 'Multiple Choice') {
                    formData.antworten.forEach(a => { content += `(${a})\n`; });
                }
                if (formData.script) {
                    content += `\n\\ Script Start\n${formData.script}\n\\ Script End\n`;
                }
                if (formData.dokumenttext) {
                    content += `\n[Dokument] ${formData.dokumenttext}\n`;
                }
                return content;
            }
            addAnswer() {
                const answersList = document.getElementById('answersList');
                const listItem = document.createElement('div');
                listItem.className = 'list-item';
                listItem.innerHTML = `<input type="text" placeholder="Neue Antwort"><button class="btn-small danger" onclick="this.parentElement.remove(); editor.updateLivePreview()">‚úï</button>`;
                listItem.querySelector('input').addEventListener('input', () => this.updateLivePreview());
                answersList.appendChild(listItem);
                listItem.querySelector('input').focus();
            }
            newQuestion() {
                const newFile = {
                    name: `frage-${Date.now()}.txt`,
                    type: 'file',
                    enhancedContent: { titel: 'Neue Frage', untertitel: '', bezeichner: `$var${Date.now()}$`, fragetyp: 'Single Select', antworten: [], script: '', dokumenttext: '' },
                    path: `frage-${Date.now()}.txt`
                };
                if (!this.structure.children) this.structure.children = [];
                this.structure.children.push(newFile);
                this.renderTree();
                this.saveStructure();
            }
            newFolder() {
                const id = Date.now();
                const newFolder = { name: `ordner-${id}`, type: 'folder', children: [], path: `ordner-${id}` };
                if (!this.structure.children) this.structure.children = [];
                this.structure.children.push(newFolder);
                this.renderTree();
                this.saveStructure();
            }
            updateFile() {
                if (!this.currentFile) return;
                const formData = this.getFormData();
                this.currentFile.enhancedContent = formData;
                this.currentFile.content = this.generateTxtContent(formData);
                const fileName = document.getElementById('fileName').value;
                if (fileName) this.currentFile.name = fileName;
                this.renderTree();
                this.saveStructure();
                this.setStatus('Datei aktualisiert');
            }
            deleteFile() {
                if (!this.currentFile || !confirm('Datei wirklich l√∂schen?')) return;
                this.removeItemFromStructure(this.currentFile);
                this.currentFile = null;
                this.clearForm();
                this.renderTree();
                this.saveStructure();
            }
            removeItemFromStructure(itemToRemove) {
                const removeFromChildren = (children) => {
                    if (!children) return false;
                    const index = children.indexOf(itemToRemove);
                    if (index > -1) { children.splice(index, 1); return true; }
                    return children.some(child => child.children && removeFromChildren(child.children));
                };
                removeFromChildren(this.structure.children);
            }
            clearForm() {
                ['questionTitle','questionSubtitle','questionDesignator','questionScript','documentText','fileName','filePath'].forEach(id => { const el = document.getElementById(id); if (el) el.value = ''; });
                document.getElementById('answersList').innerHTML = '';
                document.getElementById('livePreview').innerHTML = '<em>W√§hle eine Frage zum Bearbeiten</em>';
                document.getElementById('generatedContent').textContent = 'Noch keine Inhalte';
            }
            updateItemCount() {
                let fileCount = 0;
                const countFiles = (node) => { if (node.type === 'file') fileCount++; if (node.children) node.children.forEach(countFiles); };
                if (this.structure.children) this.structure.children.forEach(countFiles);
                document.getElementById('itemCount').textContent = `${fileCount} Fragen`;
            }
            saveStructure() { if (DialogStorage && DialogStorage.save) DialogStorage.save(this.structure); }
            importZip() { const input = document.getElementById('zipFileInput'); if (input) input.click(); }
            async handleZipImport(event) {
                const file = event.target.files[0]; if (!file) return;
                try {
                    this.setStatus('ZIP wird importiert...');
                    const structure = await ZipProcessor.parseZip(file);
                    this.structure = structure; this.renderTree(); this.saveStructure();
                    this.setStatus('ZIP erfolgreich importiert');
                } catch (_) { this.setStatus('Fehler beim Import'); }
            }
            async exportZip() {
                try {
                    this.setStatus('ZIP wird erstellt...');
                    const blob = await ZipProcessor.createZip(this.structure);
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a'); a.href = url; a.download = 'enhanced-dialog-struktur.zip'; a.click();
                    URL.revokeObjectURL(url);
                    this.setStatus('ZIP erfolgreich exportiert');
                } catch (_) { this.setStatus('Fehler beim Export'); }
            }
            save() { this.updateFile(); }
            async deployToChatbot() {
                try {
                    this.setStatus('Deploy wird vorbereitet...');
                    const blob = await ZipProcessor.createZip(this.structure);
                    const reader = new FileReader();
                    reader.onload = () => { const base64 = String(reader.result).split(',')[1]; if (DialogStorage && DialogStorage.saveZip) DialogStorage.saveZip(base64); this.setStatus('Erfolgreich deployed!'); window.open('/', '_blank'); };
                    reader.readAsDataURL(blob);
                } catch (_) { this.setStatus('Fehler beim Deploy'); }
            }
            setStatus(message) { const el = document.getElementById('statusText'); if (!el) return; el.textContent = message; setTimeout(() => { el.textContent = 'Bereit'; }, 3000); }
        }
        let editor; document.addEventListener('DOMContentLoaded', () => { editor = new EnhancedDialogEditor(); });
    </script>
</body>
</html>


