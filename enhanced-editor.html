<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juri Enhanced Dialog-Editor</title>
    <link rel="stylesheet" href="assets/css/variables.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--admin-bg); color: var(--admin-text); overflow: hidden; }
        .container { display: flex; height: 100vh; }
        .sidebar { width: 300px; background: var(--admin-surface); border-right: 1px solid var(--admin-border); display: flex; flex-direction: column; }
        .sidebar-header { padding: var(--spacing-md); border-bottom: 1px solid var(--admin-border); display: flex; align-items: center; gap: var(--spacing-sm); }
        .sidebar-header h2 { color: var(--admin-text); font-size: 16px; }
        .logo-container { width: 80px; height: 34px; }
        .editor-area { flex: 1; display: flex; flex-direction: column; }
        .editor-header { background: var(--admin-surface); padding: var(--spacing-md); border-bottom: 1px solid var(--admin-border); display: flex; justify-content: space-between; align-items: center; }
        .editor-content { flex: 1; display: flex; }
        .form-editor { flex: 1; background: var(--admin-bg); padding: var(--spacing-lg); overflow-y: auto; }
        .form-section { background: var(--admin-surface); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg); border: 1px solid var(--admin-border); }
        .form-section h3 { color: var(--primary-color); margin-bottom: var(--spacing-md); font-size: 18px; display: flex; align-items: center; gap: var(--spacing-sm); }
        .form-group { margin-bottom: var(--spacing-md); }
        .form-label { display: block; font-size: 12px; color: var(--admin-text-muted); margin-bottom: var(--spacing-xs); font-weight: 600; text-transform: uppercase; }
        .form-input, .form-select, .form-textarea { width: 100%; background: var(--admin-bg); border: 1px solid var(--admin-border); color: var(--admin-text); padding: var(--spacing-sm); border-radius: var(--radius-sm); font-size: 14px; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--primary-color); }
        .form-textarea { min-height: 100px; font-family: 'Consolas', monospace; }
        .dynamic-list { border: 1px solid var(--admin-border); border-radius: var(--radius-sm); }
        .list-item { display: flex; align-items: center; padding: var(--spacing-sm); border-bottom: 1px solid var(--admin-border); }
        .list-item:last-child { border-bottom: none; }
        .list-item input { flex: 1; background: transparent; border: none; color: var(--admin-text); padding: var(--spacing-xs); }
        .list-item input:focus { outline: none; background: var(--admin-bg); }
        .btn-small { background: var(--admin-surface-light); color: var(--admin-text); border: 1px solid var(--admin-border); padding: 4px 8px; border-radius: var(--radius-sm); cursor: pointer; font-size: 12px; }
        .btn-small:hover { background: var(--admin-border); }
        .btn-small.danger { background: #ff4757; color: white; border-color: #ff4757; }
        .btn-small.success { background: var(--secondary-color); color: white; border-color: var(--secondary-color); }
        .add-btn { width: 100%; background: var(--primary-color); color: white; border: none; padding: var(--spacing-sm); border-radius: var(--radius-sm); cursor: pointer; margin-top: var(--spacing-sm); }
        .add-btn:hover { background: var(--primary-light); }
        .question-types { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-sm); margin-bottom: var(--spacing-md); }
        .question-type { background: var(--admin-bg); border: 2px solid var(--admin-border); border-radius: var(--radius-sm); padding: var(--spacing-sm); cursor: pointer; text-align: center; transition: var(--transition-fast); }
        .question-type:hover { border-color: var(--primary-color); }
        .question-type.active { border-color: var(--primary-color); background: rgba(91, 75, 160, 0.1); }
        .question-type-icon { font-size: 20px; margin-bottom: var(--spacing-xs); }
        .question-type-name { font-size: 12px; font-weight: 600; }
        .tree-container { flex: 1; overflow-y: auto; padding: var(--spacing-sm); }
        .tree-item { padding: 6px 8px; cursor: pointer; display: flex; align-items: center; gap: var(--spacing-sm); border-radius: var(--radius-sm); transition: var(--transition-fast); }
        .tree-item:hover { background: var(--admin-surface-light); }
        .tree-item.selected { background: var(--primary-color); color: white; }
        .tree-item.file { margin-left: 16px; opacity: 0.9; }
        .tree-icon { width: 16px; text-align: center; }
        .tree-chevron { user-select: none; font-size: 10px; color: var(--admin-text-muted); transition: transform 0.2s ease; width: 16px; display: inline-block; cursor: pointer; }
        .tree-item:hover .tree-chevron { color: var(--primary-color); }
        .filter-btn { flex: 1; padding: 4px 8px; font-size: 11px; background: var(--admin-bg); border: 1px solid var(--admin-border); color: var(--admin-text); border-radius: var(--radius-sm); cursor: pointer; transition: var(--transition-fast); }
        .filter-btn:hover { border-color: var(--primary-color); }
        .filter-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .tree-item.hidden { display: none; }
        .tree-item.search-match { background: rgba(91, 75, 160, 0.1); }
        /* Tree Item Base */
        .tree-item { padding: 8px 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; border-radius: var(--radius-sm); transition: var(--transition-fast); margin-bottom: 2px; border-left: 3px solid transparent; }
        .tree-item:hover { background: var(--admin-surface-light); }
        .tree-item.selected { background: rgba(91, 75, 160, 0.15); border-left-color: var(--primary-color); }
        /* Icons Container */
        .tree-icons { display: flex; align-items: center; gap: 4px; flex-shrink: 0; }
        .tree-chevron { width: 16px; text-align: center; user-select: none; font-size: 10px; color: var(--admin-text-muted); cursor: pointer; transition: transform 0.2s ease; }
        .tree-spacer { width: 16px; display: inline-block; }
        /* Folder Styling */
        .tree-item.folder { font-weight: 600; color: var(--admin-text); }
        .tree-item.folder:hover { background: var(--admin-surface-light); }
        .folder-icon { font-size: 16px; }
        /* Fragen-File Styling */
        .tree-item.file-question { background: rgba(91, 75, 160, 0.05); border-left: 3px solid rgba(91, 75, 160, 0.3); font-weight: 500; margin-top: 4px; margin-bottom: 4px; }
        .tree-item.file-question:hover { background: rgba(91, 75, 160, 0.12); border-left-color: var(--primary-color); }
        .tree-item.file-question.selected { background: rgba(91, 75, 160, 0.2); border-left-color: var(--primary-color); }
        .question-icon { font-size: 18px; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1)); }
        /* Antwort-File Styling */
        .tree-item.file-answer { background: rgba(46, 158, 91, 0.05); border-left: 3px solid rgba(46, 158, 91, 0.3); font-size: 13px; font-weight: 400; margin-left: 20px; }
        .tree-item.file-answer:hover { background: rgba(46, 158, 91, 0.12); border-left-color: var(--secondary-color); }
        .tree-item.file-answer.selected { background: rgba(46, 158, 91, 0.2); border-left-color: var(--secondary-color); }
        .answer-icon { font-size: 16px; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1)); }
        /* Badges */
        .question-badge, .answer-badge { margin-left: auto; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .question-badge { background: var(--primary-color); color: white; }
        .answer-badge { background: var(--secondary-color); color: white; }
        /* Tree Label */
        .tree-label { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .tree-item.file-question .tree-label { color: var(--primary-color); font-size: 14px; }
        .tree-item.file-answer .tree-label { color: var(--secondary-color); font-size: 13px; }
        /* Editor Type Indicators */
        .editor-type-indicator { padding: 12px 16px; border-radius: var(--radius-md); font-weight: 600; font-size: 14px; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; }
        .question-indicator { background: linear-gradient(135deg, rgba(91, 75, 160, 0.15) 0%, rgba(91, 75, 160, 0.05) 100%); border: 2px solid var(--primary-color); color: var(--primary-color); }
        .answer-indicator { background: linear-gradient(135deg, rgba(46, 158, 91, 0.15) 0%, rgba(46, 158, 91, 0.05) 100%); border: 2px solid var(--secondary-color); color: var(--secondary-color); }
        .info-box { background: rgba(91, 75, 160, 0.05); border-left: 4px solid var(--primary-color); padding: 12px 16px; border-radius: var(--radius-sm); font-size: 13px; margin-bottom: 20px; color: var(--admin-text); }
        .info-box strong { color: var(--primary-color); }
        .properties-panel { width: 280px; background: var(--admin-surface); border-left: 1px solid var(--admin-border); padding: var(--spacing-md); overflow-y: auto; }
        .properties-panel h3 { margin-bottom: var(--spacing-md); }
        .toolbar { padding: var(--spacing-sm); border-bottom: 1px solid var(--admin-border); display: flex; gap: var(--spacing-xs); flex-wrap: wrap; }
        .section-header { padding: var(--spacing-sm); background: var(--admin-surface-light); font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--admin-text-muted); }
        .btn { background: var(--primary-color); color: white; border: none; padding: 8px 16px; border-radius: var(--radius-sm); cursor: pointer; font-size: 14px; }
        .btn:hover { background: var(--primary-light); }
        .btn-secondary { background: var(--admin-surface-light); color: var(--admin-text); }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .status-bar { background: var(--primary-color); color: white; padding: 6px var(--spacing-md); font-size: 12px; display: flex; justify-content: space-between; }
        .preview-container { background: var(--admin-surface); border-radius: var(--radius-sm); padding: var(--spacing-md); margin-top: var(--spacing-md); }
        .preview-container h4 { margin-bottom: var(--spacing-sm); color: var(--primary-color); }
        .file-input { display: none; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="assets/js/components/rechtCleverLogo.js"></script>
    <script src="assets/js/utils/dialogStorage.js"></script>
    <script src="assets/js/utils/zipProcessor.js"></script>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo-container" id="logoContainer"></div>
                <h2>Enhanced Editor</h2>
            </div>
            <div class="toolbar">
                <button class="btn btn-sm" onclick="editor.newQuestion()">➕ Frage</button>
                <button class="btn btn-sm" onclick="editor.newFolder()">📁 Ordner</button>
                <button class="btn-secondary btn-sm" onclick="editor.importZip()">📂 Import</button>
            </div>
            <div class="section-header">DIALOG STRUKTUR</div>
            <div class="breadcrumb-nav" id="breadcrumbNav" style="padding: var(--spacing-sm); border-bottom: 1px solid var(--admin-border); font-size: 12px; color: var(--admin-text-muted); display:flex; align-items:center; gap:4px; flex-wrap:wrap;">
                <span class="breadcrumb-item" data-path="">📁 Root</span>
            </div>
            <div class="search-bar" style="padding: var(--spacing-sm); border-bottom: 1px solid var(--admin-border);">
                <input type="text" id="treeSearch" class="form-input" placeholder="🔍 Suche nach Datei oder Ordner..." style="width: 100%; font-size: 12px;">
                <div class="filter-buttons" style="display: flex; gap: 4px; margin-top: 6px;">
                    <button class="filter-btn active" data-filter="all" type="button">Alle</button>
                    <button class="filter-btn" data-filter="folder" type="button">Ordner</button>
                    <button class="filter-btn" data-filter="file" type="button">Dateien</button>
                </div>
            </div>
            <div class="tree-container" id="treeContainer"></div>
            <div id="contextMenu" class="context-menu" style="display:none; position: fixed; background: var(--admin-surface); border: 1px solid var(--admin-border); border-radius: var(--radius-sm); box-shadow: var(--shadow-lg); z-index: 1000; min-width: 180px; padding: 4px 0;">
                <div class="context-item" data-action="rename" style="padding:8px 16px; cursor:pointer; font-size:13px; color:var(--admin-text);">✏️ Umbenennen</div>
                <div class="context-item" data-action="duplicate" style="padding:8px 16px; cursor:pointer; font-size:13px; color:var(--admin-text);">📋 Duplizieren</div>
                <div class="context-item" data-action="delete" style="padding:8px 16px; cursor:pointer; font-size:13px; color:var(--admin-text);">🗑️ Löschen</div>
                <div class="context-divider" style="height:1px; background:var(--admin-border); margin:4px 0;"></div>
                <div class="context-item" data-action="newFile" style="padding:8px 16px; cursor:pointer; font-size:13px; color:var(--admin-text);">➕ Neue Datei hier</div>
                <div class="context-item" data-action="newFolder" style="padding:8px 16px; cursor:pointer; font-size:13px; color:var(--admin-text);">📁 Neuer Ordner hier</div>
            </div>
        </div>
        <div class="editor-area">
            <div class="editor-header">
                <h2>Dialog-Frage bearbeiten</h2>
                <div>
                    <button class="btn" onclick="editor.save()">💾 Speichern</button>
                    <button class="btn" onclick="editor.exportZip()">📦 Export</button>
                    <button class="btn" onclick="editor.deployToChatbot()">🚀 Deploy</button>
                </div>
            </div>
            <div class="editor-content">
                <div class="form-editor" id="formEditor">
                    <div class="form-section">
                        <h3>📝 Grund-Information</h3>
                        <div class="form-group">
                            <label class="form-label">Titel (Fragetext)</label>
                            <input type="text" class="form-input" id="questionTitle" placeholder="# Wie ist dein Zivilstand?">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Untertitel (optional)</label>
                            <input type="text" class="form-input" id="questionSubtitle" placeholder="Zusätzliche Erklärung">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Bezeichner (Variable)</label>
                            <input type="text" class="form-input" id="questionDesignator" placeholder="$Zivilstand123$">
                        </div>
                    </div>
                    <div class="form-section">
                        <h3>❓ Fragetyp</h3>
                        <div class="question-types">
                            <div class="question-type" data-type="Single Select"><div class="question-type-icon">☝</div><div class="question-type-name">Single Select</div></div>
                            <div class="question-type" data-type="Multiple Choice"><div class="question-type-icon">☑</div><div class="question-type-name">Multiple Choice</div></div>
                            <div class="question-type" data-type="Text"><div class="question-type-icon">📝</div><div class="question-type-name">Text</div></div>
                            <div class="question-type" data-type="Number"><div class="question-type-icon">🔢</div><div class="question-type-name">Number</div></div>
                            <div class="question-type" data-type="Currency"><div class="question-type-icon">💰</div><div class="question-type-name">Currency</div></div>
                            <div class="question-type" data-type="Date"><div class="question-type-icon">📅</div><div class="question-type-name">Date</div></div>
                            <div class="question-type" data-type="Person"><div class="question-type-icon">👤</div><div class="question-type-name">Person</div></div>
                            <div class="question-type" data-type="Address"><div class="question-type-icon">🏠</div><div class="question-type-name">Address</div></div>
                        </div>
                        <input type="hidden" id="questionType" value="Single Select">
                    </div>
                    <div class="form-section" id="answersSection">
                        <h3>💬 Antworten</h3>
                        <div class="dynamic-list" id="answersList"></div>
                        <button class="add-btn" onclick="editor.addAnswer()">+ Antwort hinzufügen</button>
                    </div>
                    <div class="form-section">
                        <h3>🔧 Script (optional)</h3>
                        <div class="form-group">
                            <label class="form-label">JavaScript/C#-ähnliche Logik</label>
                            <textarea class="form-textarea" id="questionScript" rows="10" placeholder="if (#flag == 'true') {\n    #name = 'Max';\n} else {\n    goto $andere-frage$;\n}"></textarea>
                        </div>
                        <div class="preview-container">
                            <h4>Script-Hilfe</h4>
                            <ul style="margin-left: 20px; margin-top: 8px;">
                                <li><code>if (#variable == "wert")</code></li>
                                <li><code>#variable = "wert"</code></li>
                                <li><code>goto $ziel$</code></li>
                                <li><code>||</code>, <code>&&</code></li>
                            </ul>
                        </div>
                    </div>
                    <div class="form-section">
                        <h3>📄 Dokumentenerstellung (optional)</h3>
                        <div class="form-group">
                            <label class="form-label">Dokumenttext</label>
                            <textarea class="form-textarea" id="documentText" rows="4" placeholder="Text für das generierte Dokument..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="properties-panel">
                    <h3>Eigenschaften</h3>
                    <div class="form-group">
                        <label class="form-label">Dateiname</label>
                        <input type="text" class="form-input" id="fileName" placeholder="zivilstand.txt">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pfad</label>
                        <input type="text" class="form-input" id="filePath" readonly>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-sm" onclick="editor.updateFile()">💾 Übernehmen</button>
                        <button class="btn-secondary btn-sm" onclick="editor.deleteFile()">🗑 Löschen</button>
                    </div>
                    <div class="preview-container">
                        <h4>Live-Vorschau</h4>
                        <div id="livePreview" style="font-size: 12px; background: var(--admin-bg); padding: 8px; border-radius: 4px; margin-top: 8px;"><em>Wähle eine Frage zum Bearbeiten</em></div>
                    </div>
                    <div class="preview-container">
                        <h4>Generierte TXT-Datei</h4>
                        <pre id="generatedContent" style="font-size: 11px; background: var(--admin-bg); padding: 8px; border-radius: 4px; margin-top: 8px; white-space: pre-wrap; max-height: 200px; overflow-y: auto;"><em>Noch keine Inhalte</em></pre>
                    </div>
                </div>
            </div>
            <div class="status-bar">
                <span id="statusText">Bereit</span>
                <span id="itemCount">0 Fragen</span>
            </div>
        </div>
    </div>
    <input type="file" id="zipFileInput" accept=".zip" class="file-input">
    <script>
        class EnhancedDialogEditor {
            constructor() {
                this.structure = this.loadStructure() || this.createEmptyStructure();
                this.currentFile = null;
                this.selectedItem = null;
                this.collapsedFolders = new Set();
                this.collapsedQuestions = new Set();
                this.searchTerm = '';
                this.currentFilter = 'all';
                this.init();
            }
            init() {
                if (window.RechtCleverLogo && typeof RechtCleverLogo.render === 'function') {
                    RechtCleverLogo.render('logoContainer', 'small');
                }
                // Collapse all folders by default on first load for better overview
                if (this.structure && this.structure.children) {
                    const seedCollapsed = (node) => {
                        if (node.type === 'folder') {
                            const key = node.path || node.name;
                            this.collapsedFolders.add(key);
                        }
                        if (node.children) node.children.forEach(child => seedCollapsed(child));
                    };
                    seedCollapsed(this.structure);
                }
                this.attachEventListeners();
                this.renderTree();
                this.updateQuestionTypeHandlers();
                this.setupLivePreview();
                this.initSearch();
                this.initContextMenu();
            }
            attachEventListeners() {
                const zipInput = document.getElementById('zipFileInput');
                if (zipInput) zipInput.addEventListener('change', (e) => this.handleZipImport(e));
                ['questionTitle','questionSubtitle','questionDesignator','questionScript','documentText'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.addEventListener('input', () => this.updateLivePreview());
                });
            }
            updateQuestionTypeHandlers() {
                document.querySelectorAll('.question-type').forEach(typeEl => {
                    typeEl.addEventListener('click', () => {
                        document.querySelectorAll('.question-type').forEach(el => el.classList.remove('active'));
                        typeEl.classList.add('active');
                        const type = typeEl.dataset.type;
                        document.getElementById('questionType').value = type;
                        const answersSection = document.getElementById('answersSection');
                        if (type === 'Single Select' || type === 'Multiple Choice') {
                            answersSection.style.display = 'block';
                        } else {
                            answersSection.style.display = 'none';
                        }
                        this.updateLivePreview();
                    });
                });
            }
            setupLivePreview() {
                const defaultType = document.querySelector('[data-type="Single Select"]');
                if (defaultType) defaultType.click();
            }
            createEmptyStructure() {
                return { name: 'Root', type: 'folder', children: [], path: '' };
            }
            loadStructure() { return DialogStorage && DialogStorage.load ? DialogStorage.load() : null; }
            renderTree() {
                const container = document.getElementById('treeContainer');
                container.innerHTML = '';
                if (this.structure.children) this.structure.children.forEach(child => this.renderTreeNode(child, container, 0));
                this.updateItemCount();
                this.applyFilters();
            }
            renderTreeNode(node, container, depth, parent = null) {
                const nodeElement = document.createElement('div');
                const fileType = this.getFileType(node, depth, parent);
                nodeElement.className = `tree-item ${node.type}`;
                if (fileType) nodeElement.classList.add(`file-${fileType}`);
                nodeElement.style.paddingLeft = `${depth * 16 + 8}px`;
                let icon = '';
                let hasChildren = (node.type === 'folder' || node.type === 'file') && node.children && node.children.length > 0;
                if (node.type === 'folder') {
                    const isCollapsed = this.collapsedFolders.has(node.path || node.name);
                    const chevron = hasChildren ? (isCollapsed ? '▶' : '▼') : '';
                    icon = `<span class="tree-chevron">${chevron}</span><span class="folder-icon">📁</span>`;
                    nodeElement.addEventListener('click', () => {
                        this.toggleFolder(node);
                        this.selectNode(node, nodeElement);
                    });
                } else if (fileType === 'question') {
                    const isCollapsed = this.collapsedQuestions.has(node.path || node.name);
                    const chevron = hasChildren ? (isCollapsed ? '▶' : '▼') : '';
                    icon = `<span class="tree-chevron">${chevron}</span><span class="question-icon">❓</span>`;
                    nodeElement.addEventListener('click', () => {
                        if (hasChildren) this.toggleQuestion(node);
                        this.selectNode(node, nodeElement);
                    });
                } else if (fileType === 'answer') {
                    icon = '<span class="tree-spacer"></span><span class="answer-icon">💬</span>';
                    nodeElement.addEventListener('click', () => this.selectNode(node, nodeElement));
                } else {
                    icon = '<span class="tree-spacer"></span><span class="file-icon">📄</span>';
                    nodeElement.addEventListener('click', () => this.selectNode(node, nodeElement));
                }
                nodeElement.innerHTML = `
                    <span class="tree-icons">${icon}</span>
                    <span class="tree-label">${node.name}</span>
                    ${fileType === 'question' ? '<span class="question-badge">FRAGE</span>' : ''}
                    ${fileType === 'answer' ? '<span class="answer-badge">ANTWORT</span>' : ''}
                `;
                // Context Menu (Rechtsklick)
                nodeElement.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.showContextMenu(e, node);
                });
                container.appendChild(nodeElement);
                if (node.type === 'folder' && hasChildren) {
                    const isCollapsed = this.collapsedFolders.has(node.path || node.name);
                    if (!isCollapsed) {
                        node.children.forEach(child => this.renderTreeNode(child, container, depth + 1, node));
                    }
                } else if (fileType === 'question' && hasChildren) {
                    const isCollapsed = this.collapsedQuestions.has(node.path || node.name);
                    if (!isCollapsed) {
                        node.children.forEach(child => this.renderTreeNode(child, container, depth + 1, node));
                    }
                }
            }
            getFileType(node, depth, parent) {
                if (node.type !== 'file') return null;
                if (parent && parent.type === 'folder') return 'question';
                if (parent && parent.type === 'file') return 'answer';
                return 'question';
            }
            toggleFolder(folderNode) {
                const key = folderNode.path || folderNode.name;
                if (this.collapsedFolders.has(key)) {
                    this.collapsedFolders.delete(key);
                } else {
                    this.collapsedFolders.add(key);
                }
                this.renderTree();
            }
            toggleQuestion(questionNode) {
                const key = questionNode.path || questionNode.name;
                if (this.collapsedQuestions.has(key)) {
                    this.collapsedQuestions.delete(key);
                } else {
                    this.collapsedQuestions.add(key);
                }
                this.renderTree();
            }
            // Breadcrumb
            updateBreadcrumb(node) {
                const breadcrumb = document.getElementById('breadcrumbNav');
                if (!breadcrumb) return;
                const path = (node.path || '').split('/').filter(Boolean);
                let html = '<span class="breadcrumb-item" data-path="">📁 Root</span>';
                if (path.length > 0) {
                    path.forEach((part, index) => {
                        const currentPath = path.slice(0, index + 1).join('/');
                        html += '<span class="breadcrumb-separator"> / </span>';
                        html += `<span class="breadcrumb-item" data-path="${currentPath}">${part}</span>`;
                    });
                }
                breadcrumb.innerHTML = html;
                breadcrumb.querySelectorAll('.breadcrumb-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const targetPath = item.dataset.path || '';
                        this.navigateToPath(targetPath);
                    });
                });
            }
            navigateToPath(path) {
                if (!path) { this.selectNode(this.structure, document.createElement('div')); return; }
                const node = this.findNodeByPath(this.structure, path);
                if (node) {
                    // expand all parts of path
                    const parts = path.split('/').filter(Boolean);
                    let acc = '';
                    for (const p of parts) { acc = acc ? `${acc}/${p}` : p; this.collapsedFolders.delete(acc); }
                    this.renderTree();
                    // best effort: select by label
                    const labels = Array.from(document.querySelectorAll('.tree-label'));
                    const el = labels.find(l => (node.name && l.textContent === node.name));
                    if (el) this.selectNode(node, el.closest('.tree-item'));
                }
            }
            findNodeByPath(node, targetPath) {
                if ((node.path || '') === targetPath) return node;
                if (node.children) {
                    for (const child of node.children) {
                        const found = this.findNodeByPath(child, targetPath);
                        if (found) return found;
                    }
                }
                return null;
            }
            // Context Menu
            initContextMenu() {
                const menu = document.getElementById('contextMenu');
                if (!menu) return;
                document.addEventListener('click', (e) => {
                    if (!menu.contains(e.target)) menu.style.display = 'none';
                });
                menu.querySelectorAll('.context-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const action = item.dataset.action;
                        const node = this._contextNode;
                        menu.style.display = 'none';
                        if (!node) return;
                        this.handleContextAction(action, node);
                    });
                });
            }
            showContextMenu(event, node) {
                const menu = document.getElementById('contextMenu');
                if (!menu) return;
                this._contextNode = node;
                menu.style.display = 'block';
                menu.style.left = event.clientX + 'px';
                menu.style.top = event.clientY + 'px';
            }
            handleContextAction(action, node) {
                switch(action) {
                    case 'rename': {
                        const newName = prompt('Neuer Name:', node.name);
                        if (newName && newName.trim()) {
                            node.name = newName.trim();
                            // aktualisiere path relativ
                            const parentPath = (node.path || '').split('/').slice(0, -1).join('/');
                            node.path = parentPath ? `${parentPath}/${node.name}` : node.name;
                            this.renderTree(); this.saveStructure();
                        }
                        break;
                    }
                    case 'duplicate': {
                        const parent = this.findParentOf(this.structure, node) || this.structure;
                        const copy = JSON.parse(JSON.stringify(node));
                        copy.name = `${node.name} - Kopie`;
                        copy.path = parent.path ? `${parent.path}/${copy.name}` : copy.name;
                        (parent.children = parent.children || []).push(copy);
                        this.renderTree(); this.saveStructure();
                        break;
                    }
                    case 'delete': {
                        if (confirm(`"${node.name}" wirklich löschen?`)) {
                            this.removeItemFromStructure(node);
                            this.renderTree(); this.saveStructure();
                        }
                        break;
                    }
                    case 'newFile': {
                        const parent = node.type === 'folder' ? node : (this.findParentOf(this.structure, node) || this.structure);
                        const f = { name: `neue-datei-${Date.now()}.txt`, type: 'file', content: '', path: parent.path ? `${parent.path}/neue-datei-${Date.now()}.txt` : `neue-datei-${Date.now()}.txt` };
                        (parent.children = parent.children || []).push(f);
                        this.renderTree(); this.saveStructure();
                        break;
                    }
                    case 'newFolder': {
                        const parent = node.type === 'folder' ? node : (this.findParentOf(this.structure, node) || this.structure);
                        const id = Date.now();
                        const folder = { name: `ordner-${id}`, type: 'folder', children: [], path: parent.path ? `${parent.path}/ordner-${id}` : `ordner-${id}` };
                        (parent.children = parent.children || []).push(folder);
                        this.renderTree(); this.saveStructure();
                        break;
                    }
                }
            }
            findParentOf(root, target) {
                if (!root || !root.children) return null;
                if (root.children.includes(target)) return root;
                for (const child of root.children) {
                    const found = this.findParentOf(child, target);
                    if (found) return found;
                }
                return null;
            }
            initSearch() {
                const searchInput = document.getElementById('treeSearch');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.searchTerm = (e.target.value || '').toLowerCase();
                        this.applyFilters();
                    });
                }
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        this.currentFilter = e.currentTarget.dataset.filter || 'all';
                        this.applyFilters();
                    });
                });
            }
            applyFilters() {
                const allItems = document.querySelectorAll('.tree-item');
                allItems.forEach(item => {
                    const label = item.querySelector('.tree-label')?.textContent.toLowerCase() || '';
                    const isFolder = item.classList.contains('folder');
                    const isFile = item.classList.contains('file');
                    let typeMatch = true;
                    if (this.currentFilter === 'folder' && !isFolder) typeMatch = false;
                    if (this.currentFilter === 'file' && !isFile) typeMatch = false;
                    const searchMatch = !this.searchTerm || label.includes(this.searchTerm);
                    if (typeMatch && searchMatch) {
                        item.classList.remove('hidden');
                        if (this.searchTerm) item.classList.add('search-match'); else item.classList.remove('search-match');
                    } else {
                        item.classList.add('hidden');
                        item.classList.remove('search-match');
                    }
                });
                if (this.searchTerm) {
                    this.collapsedFolders.clear();
                    // Re-render to ensure expanded state for search
                    const container = document.getElementById('treeContainer');
                    if (container && container.childElementCount > 0) {
                        // no-op; renderTree already called after structure changes
                    }
                }
            }
            selectNode(node, element) {
                document.querySelectorAll('.tree-item.selected').forEach(item => item.classList.remove('selected'));
                element.classList.add('selected');
                this.selectedItem = node;
                if (node.type === 'file') this.loadFileIntoForm(node);
            }
            loadFileIntoForm(file) {
                this.currentFile = file;
                const fileType = this.determineFileType(file);
                if (!file.enhancedContent) file.enhancedContent = this.parseOldFormatToNew(file.content || '');
                const content = file.enhancedContent;
                if (fileType === 'question') { this.showQuestionEditor(content); }
                else if (fileType === 'answer') { this.showAnswerEditor(content); }
                document.getElementById('fileName').value = file.name || '';
                document.getElementById('filePath').value = file.path || '';
                this.updateLivePreview();
            }
            determineFileType(file) {
                // Use actual parent node to determine type to keep parity with tree rendering
                const parent = this.findParentOf(this.structure, file);
                if (!parent) return 'question';
                if (parent.type === 'folder') return 'question';
                if (parent.type === 'file') return 'answer';
                return 'question';
            }
            showQuestionEditor(content) {
                const formEditor = document.getElementById('formEditor');
                formEditor.innerHTML = `
                    <div class="editor-type-indicator question-indicator">❓ FRAGEN-EDITOR</div>
                    <div class="form-section"><h3>📝 Frage</h3>
                        <div class="form-group"><label class="form-label">Fragetext</label>
                            <input type="text" class="form-input" id="questionTitle" placeholder="# Wie ist dein Zivilstand?" value="${content.titel || ''}">
                        </div>
                        <div class="form-group"><label class="form-label">Beschreibung (optional)</label>
                            <textarea class="form-textarea" id="questionSubtitle" rows="2" placeholder="Zusätzliche Erklärung">${content.untertitel || ''}</textarea>
                        </div>
                        <div class="form-group"><label class="form-label">Variable (wird gespeichert als)</label>
                            <input type="text" class="form-input" id="questionDesignator" placeholder="$Zivilstand$" value="${content.bezeichner || ''}">
                        </div>
                    </div>
                    <div class="form-section"><h3>❓ Fragetyp</h3>
                        <div class="question-types">
                            <div class="question-type ${content.fragetyp === 'Single Select' ? 'active' : ''}" data-type="Single Select"><div class="question-type-icon">☝</div><div class="question-type-name">Single Select</div></div>
                            <div class="question-type ${content.fragetyp === 'Multiple Choice' ? 'active' : ''}" data-type="Multiple Choice"><div class="question-type-icon">☑</div><div class="question-type-name">Multiple Choice</div></div>
                            <div class="question-type ${content.fragetyp === 'Text' ? 'active' : ''}" data-type="Text"><div class="question-type-icon">📝</div><div class="question-type-name">Text</div></div>
                            <div class="question-type ${content.fragetyp === 'Number' ? 'active' : ''}" data-type="Number"><div class="question-type-icon">🔢</div><div class="question-type-name">Number</div></div>
                            <div class="question-type ${content.fragetyp === 'Currency' ? 'active' : ''}" data-type="Currency"><div class="question-type-icon">💰</div><div class="question-type-name">Currency</div></div>
                            <div class="question-type ${content.fragetyp === 'Date' ? 'active' : ''}" data-type="Date"><div class="question-type-icon">📅</div><div class="question-type-name">Date</div></div>
                        </div>
                        <input type="hidden" id="questionType" value="${content.fragetyp || 'Single Select'}">
                    </div>
                    <div class="form-section" id="answersSection" style="display: ${['Single Select', 'Multiple Choice'].includes(content.fragetyp) ? 'block' : 'none'}">
                        <h3>💬 Antwortmöglichkeiten</h3>
                        <p style="font-size: 12px; color: var(--admin-text-muted); margin-bottom: 12px;">Diese Antworten werden als Buttons/Optionen angezeigt. Für jede Antwort kann eine Follow-up Frage erstellt werden.</p>
                        <div class="dynamic-list" id="answersList"></div>
                        <button class="add-btn" onclick="editor.addAnswer()">+ Antwort hinzufügen</button>
                    </div>
                    <div class="form-section"><h3>🔧 Logik & Verzweigungen (optional)</h3>
                        <div class="form-group"><label class="form-label">Script</label>
                            <textarea class="form-textarea" id="questionScript" rows="8" placeholder="goto $andere-frage$&#10;#variable = 'wert'">${content.script || ''}</textarea>
                        </div>
                    </div>
                    <div class="form-section"><h3>📄 Dokument-Template (optional)</h3>
                        <div class="form-group"><label class="form-label">Text für generiertes Dokument</label>
                            <textarea class="form-textarea" id="documentText" rows="4" placeholder="Verwende [variable] für Platzhalter...">${content.dokumenttext || ''}</textarea>
                        </div>
                    </div>
                `;
                this.reattachEventListeners();
            }
            showAnswerEditor(content) {
                const formEditor = document.getElementById('formEditor');
                formEditor.innerHTML = `
                    <div class="editor-type-indicator answer-indicator">💬 ANTWORT-EDITOR (Follow-up)</div>
                    <div class="info-box"><strong>ℹ️ Info:</strong> Dies ist eine Antwort-Datei, die nach einer bestimmten Auswahl angezeigt wird. Antwort-Dateien sind meist einfacher und folgen direkt auf eine Frage.</div>
                    <div class="form-section"><h3>💬 Antwort-Nachricht</h3>
                        <div class="form-group"><label class="form-label">Titel</label>
                            <input type="text" class="form-input" id="questionTitle" placeholder="Verstanden!" value="${content.titel || ''}">
                        </div>
                        <div class="form-group"><label class="form-label">Nachricht</label>
                            <textarea class="form-textarea" id="questionSubtitle" rows="4" placeholder="Basierend auf deiner Auswahl...">${content.untertitel || ''}</textarea>
                        </div>
                    </div>
                    <div class="form-section"><h3>➡️ Weiterleitung</h3>
                        <div class="form-group"><label class="form-label">Nächste Frage (optional)</label>
                            <input type="text" class="form-input" id="nextQuestion" placeholder="$naechste-frage$">
                            <p style="font-size: 11px; color: var(--admin-text-muted); margin-top: 4px;">Leer lassen = Dialog endet hier</p>
                        </div>
                    </div>
                    <div class="form-section"><h3>🔧 Script (optional)</h3>
                        <div class="form-group">
                            <textarea class="form-textarea" id="questionScript" rows="4" placeholder="goto $andere-frage$">${content.script || ''}</textarea>
                        </div>
                    </div>
                    <div class="form-section"><h3>📄 Dokument-Abschnitt (optional)</h3>
                        <div class="form-group">
                            <textarea class="form-textarea" id="documentText" rows="3">${content.dokumenttext || ''}</textarea>
                        </div>
                    </div>
                `;
                this.reattachEventListeners();
            }
            reattachEventListeners() {
                document.querySelectorAll('.question-type').forEach(typeEl => {
                    typeEl.addEventListener('click', () => {
                        document.querySelectorAll('.question-type').forEach(el => el.classList.remove('active'));
                        typeEl.classList.add('active');
                        const type = typeEl.dataset.type;
                        document.getElementById('questionType').value = type;
                        const answersSection = document.getElementById('answersSection');
                        if (answersSection) answersSection.style.display = ['Single Select', 'Multiple Choice'].includes(type) ? 'block' : 'none';
                        this.updateLivePreview();
                    });
                });
                ['questionTitle', 'questionSubtitle', 'questionDesignator', 'questionScript', 'documentText'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.addEventListener('input', () => this.updateLivePreview());
                });
            }
            loadAnswers(answers) {
                const answersList = document.getElementById('answersList');
                if (!answersList) return;
                answersList.innerHTML = '';
                answers.forEach((answer, index) => {
                    const listItem = document.createElement('div');
                    listItem.className = 'list-item';
                    listItem.innerHTML = `
                        <input type="text" value="${answer}">
                        <button class="btn-small" onclick="editor.createFollowUp('${answer}', ${index})">➕ Follow-up</button>
                        <button class="btn-small danger" onclick="this.parentElement.remove(); editor.updateLivePreview()">✕</button>
                    `;
                    listItem.querySelector('input').addEventListener('input', () => this.updateLivePreview());
                    answersList.appendChild(listItem);
                });
            }
            createAnswerFile(parentQuestion, answerText) {
                const answerId = Date.now();
                const answerFile = {
                    name: `antwort-${answerText.toLowerCase().replace(/[^a-z0-9]/g, '-')}.txt`,
                    type: 'file',
                    enhancedContent: {
                        titel: 'Antwort',
                        untertitel: `Für Auswahl: ${answerText}`,
                        bezeichner: '',
                        fragetyp: 'Text',
                        antworten: [],
                        script: '',
                        dokumenttext: ''
                    },
                    path: `${parentQuestion.path}/antwort-${answerId}`,
                    content: ''
                };
                if (!parentQuestion.children) parentQuestion.children = [];
                parentQuestion.children.push(answerFile);
                return answerFile;
            }
            createFollowUp(answerText, index) {
                if (!this.currentFile || this.determineFileType(this.currentFile) !== 'question') {
                    alert('Follow-ups können nur bei Fragen erstellt werden!');
                    return;
                }
                const answerFile = this.createAnswerFile(this.currentFile, answerText);
                this.saveStructure();
                this.renderTree();
                alert(`Follow-up für "${answerText}" erstellt!`);
            }
            parseOldFormatToNew(oldContent) {
                const content = { titel: '', untertitel: '', bezeichner: '', fragetyp: 'Single Select', antworten: [], script: '', dokumenttext: '' };
                const lines = oldContent.split('\n');
                let inScript = false; const scriptLines = [];
                for (const line of lines) {
                    const trimmed = line.trim();
                    if (trimmed.includes('Script Start')) { inScript = true; continue; }
                    if (trimmed.includes('Script End')) { inScript = false; content.script = scriptLines.join('\n'); continue; }
                    if (inScript) { scriptLines.push(line); continue; }
                    if (trimmed.startsWith('#') && !content.titel) {
                        content.titel = trimmed.substring(1).trim();
                    } else if (/^\$[a-zA-Z0-9_]+\$/.test(trimmed)) {
                        content.bezeichner = trimmed;
                    } else if (trimmed.startsWith('(') && trimmed.endsWith(')')) {
                        const option = trimmed.slice(1, -1).trim();
                        content.antworten.push(option);
                    } else if (trimmed.startsWith('/')) {
                        const inputType = trimmed.substring(1);
                        content.fragetyp = this.mapInputTypeToQuestionType(inputType);
                    }
                }
                return content;
            }
            mapInputTypeToQuestionType(inputType) {
                const mapping = { 'text': 'Text', 'number': 'Number', 'currency': 'Currency', 'date': 'Date', 'person': 'Person', 'address': 'Address' };
                return mapping[inputType] || 'Text';
            }
            updateLivePreview() {
                const preview = document.getElementById('livePreview');
                const generatedContent = document.getElementById('generatedContent');
                const formData = this.getFormData();
                let previewHtml = `<strong>${formData.titel}</strong>`;
                if (formData.untertitel) previewHtml += `<br><em>${formData.untertitel}</em>`;
                if (formData.fragetyp === 'Single Select' || formData.fragetyp === 'Multiple Choice') {
                    previewHtml += '<br><br>Optionen:';
                    formData.antworten.forEach(answer => { previewHtml += `<br>• ${answer}`; });
                }
                preview.innerHTML = previewHtml;
                generatedContent.textContent = this.generateTxtContent(formData);
            }
            getFormData() {
                const answers = Array.from(document.querySelectorAll('#answersList input')).map(i => i.value).filter(v => v.trim());
                return {
                    titel: document.getElementById('questionTitle').value,
                    untertitel: document.getElementById('questionSubtitle').value,
                    bezeichner: document.getElementById('questionDesignator').value,
                    fragetyp: document.getElementById('questionType').value,
                    antworten: answers,
                    script: document.getElementById('questionScript').value,
                    dokumenttext: document.getElementById('documentText').value
                };
            }
            generateTxtContent(formData) {
                let content = '';
                content += `# ${formData.titel}\n`;
                if (formData.untertitel) content += `${formData.untertitel}\n`;
                content += `\n-----\n\n`;
                if (formData.bezeichner) content += `${formData.bezeichner}\n`;
                if (formData.fragetyp === 'Text') content += `/text\n`;
                if (formData.fragetyp === 'Number') content += `/number\n`;
                if (formData.fragetyp === 'Currency') content += `/currency\n`;
                if (formData.fragetyp === 'Date') content += `/date\n`;
                if (formData.fragetyp === 'Person') content += `/person\n`;
                if (formData.fragetyp === 'Address') content += `/address\n`;
                if (formData.fragetyp === 'Single Select' || formData.fragetyp === 'Multiple Choice') {
                    formData.antworten.forEach(a => { content += `(${a})\n`; });
                }
                if (formData.script) {
                    content += `\n\\ Script Start\n${formData.script}\n\\ Script End\n`;
                }
                if (formData.dokumenttext) {
                    content += `\n[Dokument] ${formData.dokumenttext}\n`;
                }
                return content;
            }
            addAnswer() {
                const answersList = document.getElementById('answersList');
                const listItem = document.createElement('div');
                listItem.className = 'list-item';
                listItem.innerHTML = `<input type="text" placeholder="Neue Antwort"><button class="btn-small danger" onclick="this.parentElement.remove(); editor.updateLivePreview()">✕</button>`;
                listItem.querySelector('input').addEventListener('input', () => this.updateLivePreview());
                answersList.appendChild(listItem);
                listItem.querySelector('input').focus();
            }
            newQuestion() {
                const newFile = {
                    name: `frage-${Date.now()}.txt`,
                    type: 'file',
                    enhancedContent: { titel: 'Neue Frage', untertitel: '', bezeichner: `$var${Date.now()}$`, fragetyp: 'Single Select', antworten: [], script: '', dokumenttext: '' },
                    path: `frage-${Date.now()}.txt`
                };
                if (!this.structure.children) this.structure.children = [];
                this.structure.children.push(newFile);
                this.renderTree();
                this.saveStructure();
            }
            newFolder() {
                const id = Date.now();
                const newFolder = { name: `ordner-${id}`, type: 'folder', children: [], path: `ordner-${id}` };
                if (!this.structure.children) this.structure.children = [];
                this.structure.children.push(newFolder);
                this.renderTree();
                this.saveStructure();
            }
            updateFile() {
                if (!this.currentFile) return;
                const formData = this.getFormData();
                this.currentFile.enhancedContent = formData;
                this.currentFile.content = this.generateTxtContent(formData);
                const fileName = document.getElementById('fileName').value;
                if (fileName) this.currentFile.name = fileName;
                this.renderTree();
                this.saveStructure();
                this.setStatus('Datei aktualisiert');
            }
            deleteFile() {
                if (!this.currentFile || !confirm('Datei wirklich löschen?')) return;
                this.removeItemFromStructure(this.currentFile);
                this.currentFile = null;
                this.clearForm();
                this.renderTree();
                this.saveStructure();
            }
            removeItemFromStructure(itemToRemove) {
                const removeFromChildren = (children) => {
                    if (!children) return false;
                    const index = children.indexOf(itemToRemove);
                    if (index > -1) { children.splice(index, 1); return true; }
                    return children.some(child => child.children && removeFromChildren(child.children));
                };
                removeFromChildren(this.structure.children);
            }
            clearForm() {
                ['questionTitle','questionSubtitle','questionDesignator','questionScript','documentText','fileName','filePath'].forEach(id => { const el = document.getElementById(id); if (el) el.value = ''; });
                document.getElementById('answersList').innerHTML = '';
                document.getElementById('livePreview').innerHTML = '<em>Wähle eine Frage zum Bearbeiten</em>';
                document.getElementById('generatedContent').textContent = 'Noch keine Inhalte';
            }
            updateItemCount() {
                let fileCount = 0;
                const countFiles = (node) => { if (node.type === 'file') fileCount++; if (node.children) node.children.forEach(countFiles); };
                if (this.structure.children) this.structure.children.forEach(countFiles);
                document.getElementById('itemCount').textContent = `${fileCount} Fragen`;
            }
            saveStructure() { if (DialogStorage && DialogStorage.save) DialogStorage.save(this.structure); }
            importZip() { const input = document.getElementById('zipFileInput'); if (input) input.click(); }
            async handleZipImport(event) {
                const file = event.target.files[0]; if (!file) return;
                try {
                    this.setStatus('ZIP wird importiert...');
                    const structure = await ZipProcessor.parseZip(file);
                    this.structure = structure; this.renderTree(); this.saveStructure();
                    this.setStatus('ZIP erfolgreich importiert');
                } catch (_) { this.setStatus('Fehler beim Import'); }
            }
            async exportZip() {
                try {
                    this.setStatus('ZIP wird erstellt...');
                    const blob = await ZipProcessor.createZip(this.structure);
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a'); a.href = url; a.download = 'enhanced-dialog-struktur.zip'; a.click();
                    URL.revokeObjectURL(url);
                    this.setStatus('ZIP erfolgreich exportiert');
                } catch (_) { this.setStatus('Fehler beim Export'); }
            }
            save() { this.updateFile(); }
            async deployToChatbot() {
                try {
                    this.setStatus('Deploy wird vorbereitet...');
                    const blob = await ZipProcessor.createZip(this.structure);
                    const reader = new FileReader();
                    reader.onload = () => { const base64 = String(reader.result).split(',')[1]; if (DialogStorage && DialogStorage.saveZip) DialogStorage.saveZip(base64); this.setStatus('Erfolgreich deployed!'); window.open('/', '_blank'); };
                    reader.readAsDataURL(blob);
                } catch (_) { this.setStatus('Fehler beim Deploy'); }
            }
            setStatus(message) { const el = document.getElementById('statusText'); if (!el) return; el.textContent = message; setTimeout(() => { el.textContent = 'Bereit'; }, 3000); }
        }
        let editor; document.addEventListener('DOMContentLoaded', () => { editor = new EnhancedDialogEditor(); });
    </script>
</body>
</html>


